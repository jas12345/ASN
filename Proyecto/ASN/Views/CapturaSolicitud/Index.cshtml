@model ASN.Models.CatSolicitudesSel_Result
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    .primerLabel {
        font-weight: normal;
    }

    label {
        font-size: small;
    }
</style>



@{
    int folioId = 0;

    if (Model != null)
    {
        folioId = Model.FolioSolicitud;
    }

    @Html.Hidden("folioId", folioId)
}

@if (User.Identity.IsAuthenticated)
{
    <div class="container-fluid">
        <table class="table" style="margin-bottom: 5px;">
            <tbody>
                <tr>
                    <td>
                        <label class="primerLabel" id="lblCCMSID">CCMSID:</label><br />
                        <label class="primerLabel" id="lblNombre">Nombre:</label><br />
                        <label class="primerLabel" id="lblPuesto">Puesto:</label><br />
                        <label class="primerLabel" id="lblContrato">Contrato:</label>
                    </td>
                    <td>
                        <label id="CCMSIDX"></label><br />
                        <label id="NombreX"></label><br />
                        <label id="PuestoX"></label><br />
                        <label id="ContratoX"></label>
                    </td>
                    <td>
                        <label class="primerLabel" id="lblSite">Site:</label><br />
                        <label class="primerLabel" id="lblConcepto">Concepto:</label><br />
                        <label class="primerLabel" id="lblParametro">Parametro:</label><br />
                        <label class="primerLabel" id="lblMotivo">Motivo:</label>
                    </td>
                    <td>
                        <label id="SiteX"></label><br />
                        <label id="ConceptoX"></label><br />
                        <label id="ParametroX"></label><br />
                        <label id="MotivoX"></label>
                    </td>
                    <td>
                        <label class="primerLabel" id="lblConceptoMotivo">ConceptoMotivo:</label><br />
                        <label class="primerLabel" id="lblResponsableCCMSID">Responsable de incidente:</label><br />
                        <label class="primerLabel" id="lblNombreRespo">Nombre responsable:</label><br />
                        <label class="primerLabel" id="lblPeriodoOP">Período original de pago:</label>
                    </td>
                    <td>
                        <label id="ConceptoMotivoX"></label><br />
                        <label id="ResponsableCCMSIDX"></label><br />
                        <label id="NombreRespoX"></label><br />
                        <label id="PeriodoOPX"></label>
                    </td>
                </tr>
                <tr></tr>
            </tbody>
        </table>
    </div>
    <p></p>
    <div class="container-fluid">
        <div class="row">
            <table class="table" style="margin-bottom: 5px;">
                <tbody>
                    <tr>
                        <td>
                            <div class="col-lg-4 col-lg-offset-3">
                                <label>Periodo de nómina actual</label>
                                @(Html.Kendo().DropDownList().DataSource(source =>
                                                {
                                                    source.Read(read =>
                                                        {
                                                            read.Action("GetPeriodoNominaCMB", "CapturaSolicitud");
                                                        }
                                                    );
                                                                //.ServerFiltering(true);
                                                            }
                                            )
                                        .Filter("contains")
                                        .OptionLabel("- Seleccione Periodo de Nomina - ")
                                        .DataValueField("Ident")
                                        .DataTextField("Valor")
                                        .Name("PeriodoNomina_Id")
                                        .SelectedIndex(1)
                                        .Enable(false)
                                        .HtmlAttributes(new { required = "required", style = "text-align:center;width: 15.4em", validationMessage = "Este campo es requerido." })
                                )
                            </div>
                            <div class="col-lg-4">
                                <label>Estatus</label>
                                @(Html.Kendo().TextBox().Name("Estatus")
                                                                                                        .Enable(false)
                                                                                                        .Value(string.IsNullOrEmpty(Model.Estatus) ? "Nuevo" : Model.Estatus)
                                )
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <p></p>
        @*<div class="row">
                <div class="col-lg-4">
                    @(Html.Kendo().Button().Icon("k-icon k-i-file-add").Name("Salvar").HtmlAttributes(new { StyleBundle = "width:15.4em;" } ).Content("Crear nueva solicitud"))
                </div>
            </div>*@
    </div>
    <p></p>
    <div class="container-fluid">
        <div id="Captura">
            <div class="row">
                <div class="col-lg-12 ">
                    <table class="table-responsive table" cellpadding="1" style="margin-bottom: 5px;">
                        <tr>
                            <th scope="col">
                                CCMSID
                            </th>
                            <th scope="col">
                                Concepto
                            </th>
                            <th scope="col">
                                Parametro
                            </th>
                            <th scope="col">
                                Motivo
                            </th>
                            <th scope="col">
                                ConceptoMotivo
                            </th>
                            <th scope="col">
                                Responsable de Incidente (CCMSID)
                            </th>
                            <th scope="col">
                                Período Original de Pago
                            </th>
                        </tr>
                        <tr>
                            <td>
                                @(Html.Kendo().NumericTextBox()
                                            .Name("CCMSIDSolicitado")
                                            .Spinners(false)
                                            .Decimals(0)
                                            .Format("0.")
                                            .Min(0)
                                            .Events(e => e.Change("onChangeCCMSId"))
                                            //.Step(5)
                                            //.Value(0)
                                            .HtmlAttributes(new { style = "text-align:center;", maxlength = "10" })
                                )
                            </td>
                            <td>
                                @(Html.Kendo().DropDownList().DataSource(source =>
                            {
                                source.Read(read =>
                                {
                                    read.Action("GetConceptosCMB", "CapturaSolicitud");
                                }
                                );
                                //.ServerFiltering(true);
                            }
                                            )
                                            .Filter("contains")
                                            .OptionLabel("- Conceptos - ")
                                            .DataValueField("Ident")
                                            .DataTextField("Valor")
                                            .Name("Conceptos")
                                            .Events(e => e.Change("onChangeConceptos"))
                                            //.SelectedIndex(1)
                                            .Enable(true)
                                            .HtmlAttributes(new { required = "required", style = "text-align:center;width: 15.4em", validationMessage = "Este campo es requerido." })
                                )
                            </td>
                            <td>
                                @(Html.Kendo().NumericTextBox()
                                            .Name("Parametro")
                                            .Events(e => e.Change("onChangeParametro"))
                                            .Spinners(false)
                                            .Decimals(2)
                                            .Format("0.00")
                                            .Min(0)
                                            //.Step(5)
                                            //.Value(0)
                                            .HtmlAttributes(new { style = "text-align:center;", maxlength = "10" })
                                )
                            </td>
                            <td>
                                @(Html.Kendo().DropDownList().DataSource(source =>
                            {
                                source.Read(read =>
                                {
                                    read.Action("GetMotivosCMB", "CapturaSolicitud");
                                }
                                );
                                //.ServerFiltering(true);
                            }
                                            )
                                            .Filter("contains")
                                            .OptionLabel("- Motivo - ")
                                            .DataValueField("Id")
                                            .DataTextField("Value")
                                            .Name("Motivo")
                                            .Events(e => e.Change("onChangeMotivo"))
                                            //.SelectedIndex(1)
                                            .Enable(true)
                                            .HtmlAttributes(new { required = "required", style = "text-align:center;width: 15.4em", validationMessage = "Este campo es requerido." })
                                )
                            </td>
                            <td>
                                @(Html.Kendo().DropDownList().DataSource(source =>
                            {
                                source.Read(read =>
                                {
                                    read.Action("GetConceptosMotivosCMB", "CapturaSolicitud");
                                });
                                //.ServerFiltering(true);
                            })
                                                                                        .Filter("contains")
                                                                                        .OptionLabel("- Concepto Motivo - ")
                                                                                        .DataValueField("Ident")
                                                                                        .DataTextField("Valor")
                                                                                        .Name("ConceptoMotivo")
                                                                                        .Events(e => e.Change("onChangeConceptoMotivo"))
                                                                                        //.SelectedIndex(1)
                                                                                        .Enable(true)
                                                                                        .HtmlAttributes(new { required = "required", style = "text-align:center;width: 15.4em", validationMessage = "Este campo es requerido." })
                                )
                            </td>
                            <td>
                                @(Html.Kendo().NumericTextBox()
                                                                                        .Name("CCMSIDIncidente")
                                                                                        .Events(e => e.Change("onChangeCCMSIdIncidente"))
                                                                                        .Spinners(false)
                                                                                        .Decimals(0)
                                                                                        .Format("0.")
                                                                                        .Min(0)
                                                                                        //.Step(5)
                                                                                        //.Value(0)
                                                                                        .HtmlAttributes(new { style = "text-align:center;width: 15.4em", maxlength = "10" })
                                )
                            </td>
                            <td>
                                @(Html.Kendo().DropDownList().DataSource(source =>
                            {
                                source.Read(read =>
                                {
                                    read.Action("GetPeriodoNominaCMB", "CapturaSolicitud");
                                });
                                //.ServerFiltering(true);
                            })
                                                                                        .Filter("contains")
                                                                                        .OptionLabel("- Período Incidente - ")
                                                                                        .DataValueField("Ident")
                                                                                        .DataTextField("Valor")
                                                                                        .Name("PeriodoIncidente")
                                                                                        .Events(e => e.Change("onChangePeriodoIncidente"))
                                                                                        //.SelectedIndex(1)
                                                                                        .Enable(true)
                                                                                        .HtmlAttributes(new { required = "required", style = "text-align:center;width: 15.4em", validationMessage = "Este campo es requerido." })
                                )
                            </td>
                        </tr>
                    </table>
                </div>
                <div class="col-lg-12">
                    @(Html.Kendo().Button().Name("AgregarSolicitud").Content("Agregar")
                    .Events(x => x.Click("agregarSolicitud"))
                    //.Events(x => x.Click("agregaEmpleado"))
                    )
                </div>
            </div>
        </div>
    </div>
    <p></p>
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12">
                @(Html.Kendo().Grid<ASN.Models.CatCargaRapidaSel_Result>()
                            .Name("gridSolicitud")
                            .Columns(column =>
                            {
                            //column.Command(command => { command.Custom("Editar").Text("<span class='k-icon k-i-edit'></span> Editar").Click("EditaSolicitud"); }).Width(40);
                            column.Bound(c => c.CargaRapidaId).Width(40).Title("Id").Visible(true).Filterable(true);
                                column.Bound(c => c.FolioSolicitudId).Title("FolioId").Filterable(true).Width(70).Visible(false);
                                column.Bound(c => c.CCMSID).Title("CCMSID").Filterable(true).Width(70);
                                column.Bound(c => c.ConceptoId).Title("Concepto").Width(70).Filterable(true);
                                column.Bound(c => c.Justificacion).Title("Justificacion").Filterable(true).Width(70);
                                column.Bound(c => c.Motivo).Title("Motivo").Width(70);
                            })
                            .HtmlAttributes(new { style = "height: 475px;" })
                            .Scrollable(sorteable => sorteable.Virtual(false))
                            .Sortable()
                            .PersistSelection()
                            .AutoBind(false)
                            //.Events(eve => eve.SaveChanges("onSave"))//.Change("onChange")
                            .Filterable(ftb => ftb.Mode(GridFilterMode.Row))
                            .DataSource(dataSource => dataSource
                                .Ajax()
                                .Model(model =>
                                {
                                    model.Id(c => c.CargaRapidaId);
                                    model.Field(c => c.CargaRapidaId).Editable(true);
                                    model.Field(c => c.FolioSolicitudId).Editable(true);
                                    model.Field(c => c.CCMSID).Editable(true);
                                    model.Field(c => c.ConceptoId).Editable(true);
                                    model.Field(c => c.Justificacion).Editable(true);
                                    model.Field(c => c.Motivo).Editable(true);
                                })
                                .Read(read => read.Action("GetSolicitudesRapidas", "CapturaSolicitud").Data("GetPerfil").Data("getFolio"))
                            //.Update(update => update.Action("UpdatePerdiodoNomina", "PeriodoNomina").Type(HttpVerbs.Post))
                            //.Create(create => create.Action("CrearSolicitudPorEmpleado", "CapturaSolicitud").Type(HttpVerbs.Post))
                            //.Events(ev => ev.Error("errorsote").RequestEnd("valida"))
                            )
                            .Navigatable()
                            .Pageable(pageable => pageable
                            .Refresh(true)
                            .PageSizes(true)
                            .ButtonCount(5)
                            .Numeric(true)
                            .PreviousNext(true)
                            .Messages(messages =>
                            {
                                messages.ItemsPerPage("Registros por página");
                                messages.Empty("Sin información para mostrar");
                                messages.First("Primera");
                                messages.Page("Página");
                                messages.Last("Última");
                                messages.Previous("Anterior");
                                messages.Next("Siguiente");
                                messages.Refresh("Actualizar");
                                messages.Of("De");
                                messages.MorePages("Mas páginas");
                                messages.Display("{0} a {1} de {2}");
                            })
                            )
                )
            </div>
        </div>
    </div>
    <script>
        @*var urlCrearSolicitud = '@Url.Action("CreateSolicitud", "Solicitudes")';*@
        var urlSolicitudEmpleados = '@Url.Action("GuardaEmpleados", "Solicitudes")';
        var urlDefault = '@Url.Action("Index", "Solicitudes")';
        var urlGridEmpleadosAutorizadores = '@Url.Action("GridEmpleadosAutorizantes", "EmpleadosSolicitudes")';
        var urlEnviaSolicitud = '@Url.Action("EnviarSolicitud", "Solicitudes")';
    </script>

    <script>
        //var listaEmpleados = "";
        //var selectedEmpleados = new Array();
        var grid = $('#grid');
        //var urlDeletePerfilEmpleadosAccesos = '@Url.Action("DeleteEmpleados", "CapturaSolicitud")';

        //Datos a extraer Empleado - Puesto - Contrato - Site
        var EmpCCMSId = "";
        var EmpNombre = "";
        var EmpPuestoId = "";
        var EmpPuesto = "";
        var EmpContratoId = "";
        var EmpContrato = "";
        var EmpSiteId = "";
        var EmpSite = "";

        // Sección Empleado - Puesto
        var EmpPosition_Code_Ident = "";
        var EmpPosition_Code_Title = "";
        var EmpContract_Type_Ident = "";
        var EmpContract_Type = "";
        var EmpLocation_Ident = "";
        var EmpLocation_Name = "";
        var EmpActive = "";

        // Sección Conceptos - Parámetro Conceptos
        var ConConceptoIdent = ""
        var ConConceptoNombre = ""
        var ConParametroId = ""
        var ConParametroNombre = ""

        // Sección Responsable de Incidente
        var CCMSIdIncidente = "";
        var NombreResponsableIncidente = "";

        // Sección alta de Empleados - Solicitudes
        var FolioSolicitud = ""
        var Fecha_Solicitud = ""
        var Solicitante_Ident = ""

        //Datos a extraer Perfil - Tipo de Acceso
        var nivel = "";
        var Active = "";
        var Error = "";

        //
        var urlEmpleadoPuesto = '@Url.Action("GetEmpleadoPuesto", "CapturaSolicitud")';

        //
        var urlConceptoParametroConcepto = '@Url.Action("GetConceptoParametroConcepto", "CapturaSolicitud")';

        //
        var urlPerfilTipoAcceso = '@Url.Action("GetPerfilTipoAcceso", "PerfilEmpleadosAccesos")';

        //
        var urlCrearSolicitud = '@Url.Action("CreateSolicitud", "CapturaSolicitud")';

        //
        var urlCrearEmpleadoSolicitud = '@Url.Action("CreateEmpleadoSolicitud", "CapturaSolicitud")';

        //
        var urlEmpleadoSolicitud = '@Url.Action("CreateEmpleadoSolicitud", "CapturaSolicitud")';

    //debugger;
    //var urlSolicitud = grid.selectedKeyNames().join(", ");
    </script>
}
else
{
    <script type="text/javascript">
        $(function(){
            window.location.href = "@Url.Action("Index","Inicio", new { area = "" }, null)";
        });
    </script>
}
@*@Scripts.Render("~/bundles/Solicitudes")*@

<script src="~/Scripts/CapturaSolicitud.js"></script>

<script>
    var InfoCCMSID = '@Url.Action("GetUserInfo","CapturaSolicitud")';
</script>